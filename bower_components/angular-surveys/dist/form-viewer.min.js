angular.module("mwFormViewer",["ngSanitize","ui.bootstrap","ng-sortable","pascalprecht.translate"]);
angular.module("mwFormViewer").directive("mwPriorityList",function(){return{replace:!0,restrict:"AE",require:"^mwFormQuestion",scope:{question:"=",questionResponse:"=",readOnly:"=?",options:"=?"},templateUrl:"mw-priority-list.html",controllerAs:"ctrl",bindToController:!0,controller:function(){function i(i){if(i)for(var t=0;t<i.length;t++){var e=i[t];e.priority=t+1}}function t(i){i.sort(function(i,t){return i.priority-t.priority})}var e=this;e.questionResponse.priorityList||(e.questionResponse.priorityList=[]),e.idToItem={},t(e.questionResponse.priorityList),e.availableItems=[],e.question.priorityList.forEach(function(i){e.idToItem[i.id]=i;var t=e.questionResponse.priorityList.some(function(t){return i.id==t.id});t||e.availableItems.push({priority:null,id:i.id})}),e.allItemsOrdered=0==e.availableItems.length||null;var r={disabled:e.readOnly,ghostClass:"beingDragged"};e.orderedConfig=angular.extend({},r,{group:{name:"A",pull:!1,put:["B"]},onEnd:function(t,r){i(e.questionResponse.priorityList)}}),e.availableConfig=angular.extend({},r,{sort:!1,group:{name:"B",pull:["A"],put:!1},onEnd:function(t,r){i(e.questionResponse.priorityList),e.allItemsOrdered=0==e.availableItems.length||null}})},link:function(i,t,e,r){var n=i.ctrl;n.print=r.print}}});
angular.module("mwFormViewer").directive("mwFormViewer",function(){return{replace:!0,restrict:"AE",scope:{formData:"=",responseData:"=",templateData:"=?",readOnly:"=?",options:"=?",formStatus:"=?",onSubmit:"&",api:"=?"},templateUrl:"mw-form-viewer.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout","$interpolate",function(e,t){function a(){n.formData.pages.sort(function(e,t){return e.number-t.number})}var n=this;n.defaultOptions={nestedForm:!1,autoStart:!1},n.options=angular.extend({},n.defaultOptions,n.options),n.submitStatus="NOT_SUBMITTED",n.formSubmitted=!1,a(),n.pageIdToPage={},n.formData.pages.forEach(function(e){n.pageIdToPage[e.id]=e}),n.buttons={prevPage:{visible:!1,disabled:!1},nextPage:{visible:!1,disabled:!1},submitForm:{visible:!1,disabled:!1}},n.submitForm=function(){n.formSubmitted=!0,n.submitStatus="IN_PROGRESS",n.setCurrentPage(null);var e=n.onSubmit();e.then(function(){n.submitStatus="SUCCESS"})["catch"](function(){n.submitStatus="ERROR"})},n.setCurrentPage=function(e){return n.currentPage=e,e?(n.setDefaultNextPage(),void n.initResponsesForCurrentPage()):(n.buttons.submitForm.visible=!1,n.buttons.prevPage.visible=!1,void(n.buttons.nextPage.visible=!1))},n.setDefaultNextPage=function(){var e=n.formData.pages.indexOf(n.currentPage);if(n.currentPage.isFirst=0==e,n.currentPage.isLast=e==n.formData.pages.length-1,n.buttons.submitForm.visible=n.currentPage.isLast,n.buttons.prevPage.visible=!n.currentPage.isFirst,n.buttons.nextPage.visible=!n.currentPage.isLast,n.currentPage.isLast?n.nextPage=null:n.nextPage=n.formData.pages[e+1],n.currentPage.pageFlow){var t=!1;n.currentPage.pageFlow.formSubmit?(n.nextPage=null,t=!0):n.currentPage.pageFlow.page?(n.nextPage=n.pageIdToPage[n.currentPage.pageFlow.page.id],n.buttons.nextPage.visible=!0):n.currentPage.isLast&&(n.nextPage=null,t=!0),n.buttons.submitForm.visible=t,n.buttons.nextPage.visible=!t}},n.initResponsesForCurrentPage=function(){n.currentPage.elements.forEach(function(e){var t=e.question;t&&!n.responseData[t.id]&&(n.responseData[t.id]={})})},n.beginResponse=function(){n.formData.pages.length>0&&n.setCurrentPage(n.formData.pages[0])},n.resetPages=function(){n.prevPages=[],n.currentPage=null,n.nextPage=null,n.formSubmitted=!1,n.options.autoStart&&n.beginResponse()},n.resetPages(),n.goToPrevPage=function(){var e=n.prevPages.pop();n.setCurrentPage(e),n.updateNextPageBasedOnAllAnswers()},n.goToNextPage=function(){n.prevPages.push(n.currentPage),n.updateNextPageBasedOnAllAnswers(),n.setCurrentPage(n.nextPage)},n.updateNextPageBasedOnAllAnswers=function(){n.currentPage.elements.forEach(function(e){n.updateNextPageBasedOnPageElementAnswers(e)}),n.buttons.submitForm.visible=!n.nextPage,n.buttons.nextPage.visible=!!n.nextPage},n.updateNextPageBasedOnPageElementAnswers=function(e){var t=e.question;t&&t.pageFlowModifier&&t.offeredAnswers.forEach(function(e){e.pageFlow&&n.responseData[t.id].selectedAnswer==e.id&&(e.pageFlow.formSubmit?n.nextPage=null:e.pageFlow.page&&(n.nextPage=n.pageIdToPage[e.pageFlow.page.id]))})},n.onResponseChanged=function(e){n.setDefaultNextPage(),n.updateNextPageBasedOnAllAnswers()},n.api&&(n.api.reset=function(){for(var t in n.responseData)n.responseData.hasOwnProperty(t)&&delete n.responseData[t];n.buttons.submitForm.visible=!1,n.buttons.prevPage.visible=!1,n.buttons.nextPage.visible=!1,n.currentPage=null,e(n.resetPages,0)}),n.print=function(e){return n.templateData?t(e)(n.templateData):e}}],link:function(e,t,a){var n=e.ctrl;n.formStatus&&(n.formStatus.form=n.form)}}});
angular.module("mwFormViewer").factory("FormQuestionId",function(){var e=0;return{next:function(){return++e}}}).directive("mwFormQuestion",function(){return{replace:!0,restrict:"AE",require:"^mwFormViewer",scope:{question:"=",questionResponse:"=",readOnly:"=?",options:"=?",onResponseChanged:"&?"},templateUrl:"mw-form-question.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout","FormQuestionId",function(e,n){var s=this;s.id=n.next(),"radio"==s.question.type?(s.questionResponse.selectedAnswer||(s.questionResponse.selectedAnswer=null),s.questionResponse.other&&(s.isOtherAnswer=!0)):"checkbox"==s.question.type?(s.questionResponse.selectedAnswers&&s.questionResponse.selectedAnswers.length?s.selectedAnswer=!0:s.questionResponse.selectedAnswers=[],s.questionResponse.other&&(s.isOtherAnswer=!0)):"grid"==s.question.type?s.question.grid.cellInputType||(s.question.grid.cellInputType="radio"):"division"==s.question.type&&(s.computeDivisionSum=function(){s.divisionSum=0,s.question.divisionList.forEach(function(e){0==s.questionResponse[e.id]||s.questionResponse[e.id]?s.divisionSum+=s.questionResponse[e.id]:(s.questionResponse[e.id]=null,s.divisionSum+=0)})},s.computeDivisionSum()),s.isAnswerSelected=!1,s.selectedAnswerChanged=function(){delete s.questionResponse.other,s.isOtherAnswer=!1,s.answerChanged()},s.otherAnswerRadioChanged=function(){void 0,s.isOtherAnswer&&(s.questionResponse.selectedAnswer=null),s.answerChanged()},s.otherAnswerCheckboxChanged=function(){s.isOtherAnswer||delete s.questionResponse.other,s.selectedAnswer=!(!s.questionResponse.selectedAnswers.length&&!s.isOtherAnswer)||null,s.answerChanged()},s.toggleSelectedAnswer=function(e){s.questionResponse.selectedAnswers.indexOf(e.id)===-1?s.questionResponse.selectedAnswers.push(e.id):s.questionResponse.selectedAnswers.splice(s.questionResponse.selectedAnswers.indexOf(e.id),1),s.selectedAnswer=!(!s.questionResponse.selectedAnswers.length&&!s.isOtherAnswer)||null,s.answerChanged()},s.answerChanged=function(){s.onResponseChanged&&s.onResponseChanged()}}],link:function(e,n,s,o){var t=e.ctrl;t.print=o.print}}});
angular.module("mwFormViewer").directive("mwFormConfirmationPage",function(){return{replace:!0,restrict:"AE",require:"^mwFormViewer",scope:{submitStatus:"=",confirmationMessage:"=",readOnly:"=?"},templateUrl:"mw-form-confirmation-page.html",controllerAs:"ctrl",bindToController:!0,controller:function(){},link:function(r,e,t,n){var o=r.ctrl;o.print=n.print}}});