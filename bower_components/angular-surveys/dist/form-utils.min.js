angular.module("mwFormUtils",["mwFormUtils.responseUtils"]);
angular.module("mwFormUtils.responseUtils",[]).factory("mwFormResponseUtils",function(){var e={},r=["text","textarea","number","date","time","email","range","url"];return e.$getObjectByIdMap=function(e,r){var t={};return e?(e.forEach(function(e){var i=e;r&&(i=r(e)),t[e.id]=i}),t):t},e.$getOfferedAnswerByIdMap=function(r){return e.$getObjectByIdMap(r.offeredAnswers,function(e){return{id:e.id,value:e.value}})},e.$extractResponseForQuestionWithOfferedAnswers=function(r,t){var i=e.$getOfferedAnswerByIdMap(r),n={};return t.selectedAnswers?(n.selectedAnswers=[],t.selectedAnswers.forEach(function(e){n.selectedAnswers.push(i[e])})):t.selectedAnswer&&(n.selectedAnswer=i[t.selectedAnswer]),t.other&&(n.other=t.other),n},e.$extractResponseForPriorityQuestion=function(r,t){var i=[];if(!t.priorityList)return i;var n=e.$getObjectByIdMap(r.priorityList);return t.priorityList.forEach(function(e){var r=n[e.id];i.push({id:r.id,value:r.value,priority:e.priority})}),i},e.$extractResponseForDivisionQuestion=function(r,t){var i=[],n=e.$getObjectByIdMap(r.divisionList);return Object.getOwnPropertyNames(t).forEach(function(e){var r=t[e],o=n[e];o&&i.push({id:o.id,label:o.value,value:r})}),i},e.$extractResponseForGridQuestion=function(r,t){if(!r.grid||!r.grid.rows)return i;if("radio"==r.grid.cellInputType)return e.$extractResponseForRadioGridQuestion(r,t);var i=[];return r.grid.rows.forEach(function(e){r.grid.cols.forEach(function(r){var n={row:{id:e.id,label:e.label},col:{id:r.id,label:r.label},value:null};t.hasOwnProperty(e.id)&&t[e.id].hasOwnProperty(r.id)&&(n.value=t[e.id][r.id]),i.push(n)})}),i},e.$extractResponseForRadioGridQuestion=function(r,t){var i=[],n=e.$getObjectByIdMap(r.grid.cols);return r.grid.rows.forEach(function(e){var r=t[e.id],o=null;r&&(o=n[r]);var s={row:{id:e.id,label:e.label},col:null};o&&(s.col={id:o.id,label:o.label}),i.push(s)}),i},e.extractResponse=function(t,i){return r.indexOf(t.type)!==-1?i.answer:"radio"==t.type||"checkbox"==t.type||"select"==t.type?e.$extractResponseForQuestionWithOfferedAnswers(t,i):"grid"==t.type?e.$extractResponseForGridQuestion(t,i):"priority"==t.type?e.$extractResponseForPriorityQuestion(t,i):"division"==t.type?e.$extractResponseForDivisionQuestion(t,i):null},e.mergeFormWithResponse=function(r,t){var i={};return angular.copy(r,i),i.pages.forEach(function(r){r.elements.forEach(function(r){var i=r.question;if(i){var n=t[i.id];n&&(i.response=e.extractResponse(i,n))}})}),i},e.getQuestionList=function(e,r){var t=[];return e.pages.forEach(function(e){e.elements.forEach(function(e){if(e.question){var i=e.question;r&&(i={},angular.copy(e.question,i)),t.push(i)}})}),t},e.getQuestionWithResponseList=function(r,t){var i=[];return e.getQuestionList(r,!0).forEach(function(r){var n=t[r.id];n?r.response=e.extractResponse(r,n):r.response=null,i.push(r)}),i},e.$$getHeader=function(e,r,t,i,n){var o="";return n&&((e||0===e)&&(o+=e+"."),null!==t&&void 0!==t&&(Array.isArray(t)||(t=[t]),t.forEach(function(e){o+=e+"."})),o.length&&(o+=" ")),o+=r,null===i||void 0===i?o:(Array.isArray(i)||(i=[i]),i.forEach(function(e){o+=" ["+e+"]"}),o)},e.getResponseSheetHeaders=function(r,t){var i=["grid","priority","division"],n=[],o=0;return e.getQuestionList(r).forEach(function(r){o++;var s=1;if(i.indexOf(r.type)===-1)n.push(e.$$getHeader(o,r.text,null,null,t));else if("grid"==r.type){if(!r.grid)return;"radio"==r.grid.cellInputType?r.grid.rows.forEach(function(i){n.push(e.$$getHeader(o,r.text,s,i.label,t)),s++}):r.grid.rows.forEach(function(i,u){r.grid.cols.forEach(function(a,c){n.push(e.$$getHeader(o,r.text,[u+1,c+1],[i.label,a.label],t)),s++})})}else if("priority"==r.type){if(!r.priorityList)return;r.priorityList.forEach(function(i){n.push(e.$$getHeader(o,r.text,s,i.value,t)),s++})}else if("division"==r.type){if(!r.divisionList)return;r.divisionList.forEach(function(i){n.push(e.$$getHeader(o,r.text,s,i.value,t)),s++})}}),n},e.getResponseSheetRow=function(r,t){var i="; ",n=[];if(!t)return n;for(var o=e.getQuestionWithResponseList(r,t),s=["radio","checkbox","select","grid","priority","division"],u=0;u<o.length;u++){var a=o[u],c=a.response;if(s.indexOf(a.type)!==-1){if("radio"==a.type||"select"==a.type){if(!c){n.push("");continue}var f="";c.selectedAnswer&&(f=c.selectedAnswer.value),c.other&&(f&&(f+=i),f+=c.other),n.push(f)}else if("checkbox"==a.type){if(!c||!c.selectedAnswers){n.push("");continue}var f="";c.selectedAnswers.forEach(function(e){f&&(f+=i),f+=e.value}),c.other&&(f&&(f+=i),f+=c.other),n.push(f)}else if("grid"==a.type){if(!a.grid)continue;if(!c){"radio"==a.grid.cellInputType?a.grid.rows.forEach(function(){n.push("")}):a.grid.rows.forEach(function(){a.grid.cols.forEach(function(){n.push("")})});continue}"radio"==a.grid.cellInputType?c.forEach(function(e){n.push(e.col?e.col.label:"")}):c.forEach(function(e){n.push(e.value)})}else if("priority"==a.type){if(!a.priorityList)continue;var p=e.$getObjectByIdMap(c);a.priorityList.forEach(function(e){var r=p[e.id];r?n.push(r.priority):n.push("")})}else if("division"==a.type){if(!a.divisionList)continue;var d=e.$getObjectByIdMap(c);a.divisionList.forEach(function(e){var r=d[e.id];r?n.push(r.value):n.push("")})}}else n.push(c?c:"")}return n},e.getResponseSheetRows=function(r,t){return t.map(function(t){return e.getResponseSheetRow(r,t)})},e.getResponseSheet=function(r,t,i){var n=[],o=e.getResponseSheetHeaders(r,i);return n.push(o),t?(t instanceof Array?t.forEach(function(t){n.push(e.getResponseSheetRow(r,t))}):n.push(e.getResponseSheetRow(r,t)),n):n},e});